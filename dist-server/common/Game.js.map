{"version":3,"sources":["../../src/common/Game.js"],"names":["PADDING","WIDTH","HEIGHT","PADDLE_WIDTH","PADDLE_HEIGHT","shuffle","arr","currentIndex","length","randomIndex","temporaryValue","Math","floor","random","Plate","gameEngine","options","props","bites","other","Object","assign","type","BaseTypes","TYPES","INT16","DynamicObject","Game","physicsEngine","SimplePhysicsEngine","on","gameLogic","bind","serverSideInit","serverSidePlayerJoined","serverSidePlayerDisconnected","clientSideInit","clientSideDraw","serializer","registerClass","plates","world","queryObjects","instanceType","forEach","p","i","console","log","inputData","playerId","playerPlate","queryObject","input","addObjectToWorld","ev","joined","plate","removeObjectFromWorld","id","controls","KeyboardControls","renderer","clientEngine","order","document","querySelector","o","button","createElement","classList","add","setAttribute","innerHTML","addEventListener","querySelectorAll","sendInput","appendChild","selector","plateElement","remove","style","width","GameEngine"],"mappings":"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","sourcesContent":["import { GameEngine, BaseTypes, TwoVector, DynamicObject, KeyboardControls, SimplePhysicsEngine } from 'lance-gg';\n\nconst PADDING = 30;\nconst WIDTH = 400;\nconst HEIGHT = 400;\nconst PADDLE_WIDTH = 10;\nconst PADDLE_HEIGHT = 50;\n\nconst shuffle = arr => {\n  let currentIndex = arr.length;\n  let randomIndex;\n  let temporaryValue;\n\n  // While there remain elements to shuffle...\n  while (0 !== currentIndex) {\n\n    // Pick a remaining element...\n    randomIndex = Math.floor(Math.random() * currentIndex);\n    currentIndex -= 1;\n\n    // And swap it with the current element.\n    temporaryValue = arr[currentIndex];\n    arr[currentIndex] = arr[randomIndex];\n    arr[randomIndex] = temporaryValue;\n  }\n\n  return arr;\n}\n\n// A paddle has a health attribute\nclass Plate extends DynamicObject {\n\n    constructor(gameEngine, options, props) {\n        super(gameEngine, options, props);\n        this.bites = 0;\n    }\n\n    static get netScheme() {\n        return Object.assign({\n            bites: { type: BaseTypes.TYPES.INT16 }\n        }, super.netScheme);\n    }\n\n    syncTo(other) {\n        super.syncTo(other);\n        this.bites = other.bites;\n    }\n}\n\nexport default class Game extends GameEngine {\n\n    constructor(options) {\n        super(options);\n        this.physicsEngine = new SimplePhysicsEngine({ gameEngine: this });\n\n        // common code\n        this.on('postStep', this.gameLogic.bind(this));\n\n        // server-only code\n        this.on('server__init', this.serverSideInit.bind(this));\n        this.on('server__playerJoined', this.serverSidePlayerJoined.bind(this));\n        this.on('server__playerDisconnected', this.serverSidePlayerDisconnected.bind(this));\n\n        // client-only code\n        this.on('client__rendererReady', this.clientSideInit.bind(this));\n        this.on('client__draw', this.clientSideDraw.bind(this));\n    }\n\n    registerClasses(serializer) {\n        serializer.registerClass(Plate);\n    }\n\n    gameLogic() {\n        let plates = this.world.queryObjects({ instanceType: Plate });\n\n        if (plates.length < 2) return;\n\n        plates.forEach((p, i) => {\n            if (p.bites === 9) {\n                console.log(`player ${i} wins`);\n            }\n        })\n    }\n\n    processInput(inputData, playerId) {\n        super.processInput(inputData, playerId);\n\n        // get the player paddle tied to the player socket\n        let playerPlate = this.world.queryObject({ playerId });\n        if (playerPlate) {\n            if (inputData.input === 'bite') {\n                playerPlate.bites++;\n            }\n        }\n    }\n\n    //\n    // SERVER ONLY CODE\n    //\n    serverSideInit() {\n        // create the paddles and the ball\n        this.addObjectToWorld(new Plate(this, null, { playerId: 0, bites: 0 }));\n        this.addObjectToWorld(new Plate(this, null, { playerId: 0, bites: 0 }));\n        this.addObjectToWorld(new Plate(this, null, { playerId: 0, bites: 0 }));\n        this.addObjectToWorld(new Plate(this, null, { playerId: 0, bites: 0 }));\n        this.addObjectToWorld(new Plate(this, null, { playerId: 0, bites: 0 }));\n        this.addObjectToWorld(new Plate(this, null, { playerId: 0, bites: 0 }));\n    }\n\n    // attach newly connected player to next available paddle\n    serverSidePlayerJoined(ev) {\n        const plates = this.world.queryObjects({ instanceType: Plate });\n\n        let joined = false;\n\n        plates.forEach(plate => {\n            if (joined) {\n                return;\n            }\n\n            if (plate.playerId === 0) {\n                plate.playerId = ev.playerId;\n\n                joined = true;\n            }\n        })\n    }\n\n    serverSidePlayerDisconnected(ev) {\n        const plates = this.world.queryObjects({ instanceType: Plate });\n\n        plates.forEach(plate => {\n            if (plate.playerId !== ev.playerId) {\n                return;\n            }\n            this.removeObjectFromWorld(plate.id);\n        });\n    }\n\n    //\n    // CLIENT ONLY CODE\n    //\n    clientSideInit() {\n        this.controls = new KeyboardControls(this.renderer.clientEngine);\n\n        const order = [0, 1, 2, 3, 4, 5, 6, 7, 8];\n\n        shuffle(order);\n\n        const bites = document.querySelector('#bites');\n\n        order.forEach(o => {\n            let button = document.createElement('button'); \n\n            button.classList.add('bite');\n\n            button.setAttribute('data-order', o);\n\n            button.innerHTML = 'bite ' + o;\n\n            button.addEventListener('click', ev => {\n                if (o !== document.querySelectorAll('.bite.hidden').length) {\n                    return true;\n                }\n\n                button.classList.add('hidden');\n\n                this.controls.clientEngine.sendInput('bite');\n            });\n\n            bites.appendChild(button);\n        });\n    }\n\n    clientSideDraw() {\n        let plates = this.world.queryObjects({ instanceType: Plate });\n\n        if (!plates.length) {\n            return;\n        }\n\n        plates.forEach((plate, i) => {\n            const selector = '#plate' + i;\n\n            const plateElement = document.querySelector(selector);\n\n            if (plateElement) {\n                plateElement.classList.remove('hidden');\n                plateElement.style.width = ((9 - plate.bites) * 20) + 'px';\n                plateElement.innerHTML = plate.playerId;\n            }\n        });\n    }\n}\n\n"],"file":"Game.js"}