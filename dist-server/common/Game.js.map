{"version":3,"sources":["../../src/common/Game.js"],"names":["PADDING","WIDTH","HEIGHT","PADDLE_WIDTH","PADDLE_HEIGHT","Plate","gameEngine","options","props","bites","other","Object","assign","type","BaseTypes","TYPES","INT16","DynamicObject","Game","physicsEngine","SimplePhysicsEngine","on","gameLogic","bind","serverSideInit","serverSidePlayerJoined","serverSidePlayerDisconnected","clientSideInit","clientSideDraw","serializer","registerClass","plates","world","queryObjects","instanceType","length","forEach","p","i","console","log","inputData","playerId","playerPlate","queryObject","input","addObjectToWorld","ev","joined","plate","removeObjectFromWorld","id","controls","KeyboardControls","renderer","clientEngine","bindKey","selector","plateElement","document","querySelector","classList","remove","style","width","innerHTML","GameEngine"],"mappings":";;;;;;;AAAA;;;;;;;;;;;;;;;;;;;;;;;;AAEA,IAAMA,OAAO,GAAG,EAAhB;AACA,IAAMC,KAAK,GAAG,GAAd;AACA,IAAMC,MAAM,GAAG,GAAf;AACA,IAAMC,YAAY,GAAG,EAArB;AACA,IAAMC,aAAa,GAAG,EAAtB,C,CAEA;;IACMC,K;;;;;AAEF,iBAAYC,UAAZ,EAAwBC,OAAxB,EAAiCC,KAAjC,EAAwC;AAAA;;AAAA;;AACpC,+EAAMF,UAAN,EAAkBC,OAAlB,EAA2BC,KAA3B;AACA,UAAKC,KAAL,GAAa,CAAb;AAFoC;AAGvC;;;;2BAQMC,K,EAAO;AACV,wEAAaA,KAAb;;AACA,WAAKD,KAAL,GAAaC,KAAK,CAACD,KAAnB;AACH;;;wBATsB;AACnB,aAAOE,MAAM,CAACC,MAAP,CAAc;AACjBH,QAAAA,KAAK,EAAE;AAAEI,UAAAA,IAAI,EAAEC,mBAAUC,KAAV,CAAgBC;AAAxB;AADU,OAAd,kDAAP;AAGH;;;;EAXeC,sB;;IAmBCC,I;;;;;AAEjB,gBAAYX,OAAZ,EAAqB;AAAA;;AAAA;;AACjB,+EAAMA,OAAN;AACA,WAAKY,aAAL,GAAqB,IAAIC,4BAAJ,CAAwB;AAAEd,MAAAA,UAAU;AAAZ,KAAxB,CAArB,CAFiB,CAIjB;;AACA,WAAKe,EAAL,CAAQ,UAAR,EAAoB,OAAKC,SAAL,CAAeC,IAAf,gCAApB,EALiB,CAOjB;;;AACA,WAAKF,EAAL,CAAQ,cAAR,EAAwB,OAAKG,cAAL,CAAoBD,IAApB,gCAAxB;;AACA,WAAKF,EAAL,CAAQ,sBAAR,EAAgC,OAAKI,sBAAL,CAA4BF,IAA5B,gCAAhC;;AACA,WAAKF,EAAL,CAAQ,4BAAR,EAAsC,OAAKK,4BAAL,CAAkCH,IAAlC,gCAAtC,EAViB,CAYjB;;;AACA,WAAKF,EAAL,CAAQ,uBAAR,EAAiC,OAAKM,cAAL,CAAoBJ,IAApB,gCAAjC;;AACA,WAAKF,EAAL,CAAQ,cAAR,EAAwB,OAAKO,cAAL,CAAoBL,IAApB,gCAAxB;;AAdiB;AAepB;;;;oCAEeM,U,EAAY;AACxBA,MAAAA,UAAU,CAACC,aAAX,CAAyBzB,KAAzB;AACH;;;gCAEW;AACR,UAAI0B,MAAM,GAAG,KAAKC,KAAL,CAAWC,YAAX,CAAwB;AAAEC,QAAAA,YAAY,EAAE7B;AAAhB,OAAxB,CAAb;AAEA,UAAI0B,MAAM,CAACI,MAAP,GAAgB,CAApB,EAAuB;AAEvBJ,MAAAA,MAAM,CAACK,OAAP,CAAe,UAACC,CAAD,EAAIC,CAAJ,EAAU;AACrB,YAAID,CAAC,CAAC5B,KAAF,KAAY,CAAhB,EAAmB;AACf8B,UAAAA,OAAO,CAACC,GAAR,kBAAsBF,CAAtB;AACH;AACJ,OAJD;AAKH;;;iCAEYG,S,EAAWC,Q,EAAU;AAC9B,6EAAmBD,SAAnB,EAA8BC,QAA9B,EAD8B,CAG9B;;;AACA,UAAIC,WAAW,GAAG,KAAKX,KAAL,CAAWY,WAAX,CAAuB;AAAEF,QAAAA,QAAQ,EAARA;AAAF,OAAvB,CAAlB;;AACA,UAAIC,WAAJ,EAAiB;AACb,YAAIF,SAAS,CAACI,KAAV,KAAoB,OAAxB,EAAiC;AAE7BN,UAAAA,OAAO,CAACC,GAAR,kBAAsBE,QAAtB;AAEAC,UAAAA,WAAW,CAAClC,KAAZ;AACH;AACJ;AACJ,K,CAED;AACA;AACA;;;;qCACiB;AACb;AACA,WAAKqC,gBAAL,CAAsB,IAAIzC,KAAJ,CAAU,IAAV,EAAgB,IAAhB,EAAsB;AAAEqC,QAAAA,QAAQ,EAAE,CAAZ;AAAejC,QAAAA,KAAK,EAAE;AAAtB,OAAtB,CAAtB;AACA,WAAKqC,gBAAL,CAAsB,IAAIzC,KAAJ,CAAU,IAAV,EAAgB,IAAhB,EAAsB;AAAEqC,QAAAA,QAAQ,EAAE,CAAZ;AAAejC,QAAAA,KAAK,EAAE;AAAtB,OAAtB,CAAtB;AACA,WAAKqC,gBAAL,CAAsB,IAAIzC,KAAJ,CAAU,IAAV,EAAgB,IAAhB,EAAsB;AAAEqC,QAAAA,QAAQ,EAAE,CAAZ;AAAejC,QAAAA,KAAK,EAAE;AAAtB,OAAtB,CAAtB;AACA,WAAKqC,gBAAL,CAAsB,IAAIzC,KAAJ,CAAU,IAAV,EAAgB,IAAhB,EAAsB;AAAEqC,QAAAA,QAAQ,EAAE,CAAZ;AAAejC,QAAAA,KAAK,EAAE;AAAtB,OAAtB,CAAtB;AACA,WAAKqC,gBAAL,CAAsB,IAAIzC,KAAJ,CAAU,IAAV,EAAgB,IAAhB,EAAsB;AAAEqC,QAAAA,QAAQ,EAAE,CAAZ;AAAejC,QAAAA,KAAK,EAAE;AAAtB,OAAtB,CAAtB;AACA,WAAKqC,gBAAL,CAAsB,IAAIzC,KAAJ,CAAU,IAAV,EAAgB,IAAhB,EAAsB;AAAEqC,QAAAA,QAAQ,EAAE,CAAZ;AAAejC,QAAAA,KAAK,EAAE;AAAtB,OAAtB,CAAtB;AACH,K,CAED;;;;2CACuBsC,E,EAAI;AAC/BR,MAAAA,OAAO,CAACC,GAAR,CAAY,kBAAkBO,EAAE,CAACL,QAAjC;AACQ,UAAMX,MAAM,GAAG,KAAKC,KAAL,CAAWC,YAAX,CAAwB;AAAEC,QAAAA,YAAY,EAAE7B;AAAhB,OAAxB,CAAf;AAEA,UAAI2C,MAAM,GAAG,KAAb;AAEAjB,MAAAA,MAAM,CAACK,OAAP,CAAe,UAAAa,KAAK,EAAI;AACpB,YAAID,MAAJ,EAAY;AACR;AACH;;AAED,YAAIC,KAAK,CAACP,QAAN,KAAmB,CAAvB,EAA0B;AACtCH,UAAAA,OAAO,CAACC,GAAR,CAAY,4BAA4BO,EAAE,CAACL,QAA3C;AACgBO,UAAAA,KAAK,CAACP,QAAN,GAAiBK,EAAE,CAACL,QAApB;AAEAM,UAAAA,MAAM,GAAG,IAAT;AACH;AACJ,OAXD;AAaRT,MAAAA,OAAO,CAACC,GAAR,CAAY,QAAZ;AACAD,MAAAA,OAAO,CAACC,GAAR,CAAYT,MAAZ;AAGK;;;iDAE4BgB,E,EAAI;AAAA;;AAC7B,UAAMhB,MAAM,GAAG,KAAKC,KAAL,CAAWC,YAAX,CAAwB;AAAEC,QAAAA,YAAY,EAAE7B;AAAhB,OAAxB,CAAf;AAEA0B,MAAAA,MAAM,CAACK,OAAP,CAAe,UAAAa,KAAK,EAAI;AACpB,YAAIA,KAAK,CAACP,QAAN,KAAmBK,EAAE,CAACL,QAA1B,EAAoC;AAChC;AACH;;AACDH,QAAAA,OAAO,CAACC,GAAR,CAAY,eAAZ;;AACA,QAAA,MAAI,CAACU,qBAAL,CAA2BD,KAAK,CAACE,EAAjC;AACH,OAND;AAOH,K,CAED;AACA;AACA;;;;qCACiB;AACb,WAAKC,QAAL,GAAgB,IAAIC,yBAAJ,CAAqB,KAAKC,QAAL,CAAcC,YAAnC,CAAhB;AACA,WAAKH,QAAL,CAAcI,OAAd,CAAsB,OAAtB,EAA+B,OAA/B;AACH;;;qCAEgB;AACb,UAAIzB,MAAM,GAAG,KAAKC,KAAL,CAAWC,YAAX,CAAwB;AAAEC,QAAAA,YAAY,EAAE7B;AAAhB,OAAxB,CAAb;AAERkC,MAAAA,OAAO,CAACC,GAAR,CAAY,eAAZ;AACAD,MAAAA,OAAO,CAACC,GAAR,CAAYT,MAAM,CAACI,MAAnB;;AAEQ,UAAI,CAACJ,MAAM,CAACI,MAAZ,EAAoB;AAChB;AACH;;AAEDJ,MAAAA,MAAM,CAACK,OAAP,CAAe,UAACa,KAAD,EAAQX,CAAR,EAAc;AACzB,YAAMmB,QAAQ,GAAG,WAAWnB,CAA5B;AAEZC,QAAAA,OAAO,CAACC,GAAR,CAAY,UAAZ;AACAD,QAAAA,OAAO,CAACC,GAAR,CAAYiB,QAAZ;AAEY,YAAMC,YAAY,GAAGC,QAAQ,CAACC,aAAT,CAAuBH,QAAvB,CAArB;;AAEA,YAAIC,YAAJ,EAAkB;AACdA,UAAAA,YAAY,CAACG,SAAb,CAAuBC,MAAvB,CAA8B,QAA9B;AACAJ,UAAAA,YAAY,CAACK,KAAb,CAAmBC,KAAnB,GAA4B,CAAC,IAAIf,KAAK,CAACxC,KAAX,IAAoB,EAArB,GAA2B,IAAtD;AACAiD,UAAAA,YAAY,CAACO,SAAb,GAAyBhB,KAAK,CAACP,QAA/B;AACH;AACJ,OAbD;AAcH;;;;EArI6BwB,mB","sourcesContent":["import { GameEngine, BaseTypes, TwoVector, DynamicObject, KeyboardControls, SimplePhysicsEngine } from 'lance-gg';\n\nconst PADDING = 30;\nconst WIDTH = 400;\nconst HEIGHT = 400;\nconst PADDLE_WIDTH = 10;\nconst PADDLE_HEIGHT = 50;\n\n// A paddle has a health attribute\nclass Plate extends DynamicObject {\n\n    constructor(gameEngine, options, props) {\n        super(gameEngine, options, props);\n        this.bites = 0;\n    }\n\n    static get netScheme() {\n        return Object.assign({\n            bites: { type: BaseTypes.TYPES.INT16 }\n        }, super.netScheme);\n    }\n\n    syncTo(other) {\n        super.syncTo(other);\n        this.bites = other.bites;\n    }\n}\n\nexport default class Game extends GameEngine {\n\n    constructor(options) {\n        super(options);\n        this.physicsEngine = new SimplePhysicsEngine({ gameEngine: this });\n\n        // common code\n        this.on('postStep', this.gameLogic.bind(this));\n\n        // server-only code\n        this.on('server__init', this.serverSideInit.bind(this));\n        this.on('server__playerJoined', this.serverSidePlayerJoined.bind(this));\n        this.on('server__playerDisconnected', this.serverSidePlayerDisconnected.bind(this));\n\n        // client-only code\n        this.on('client__rendererReady', this.clientSideInit.bind(this));\n        this.on('client__draw', this.clientSideDraw.bind(this));\n    }\n\n    registerClasses(serializer) {\n        serializer.registerClass(Plate);\n    }\n\n    gameLogic() {\n        let plates = this.world.queryObjects({ instanceType: Plate });\n\n        if (plates.length < 2) return;\n\n        plates.forEach((p, i) => {\n            if (p.bites === 9) {\n                console.log(`player ${i} wins`);\n            }\n        })\n    }\n\n    processInput(inputData, playerId) {\n        super.processInput(inputData, playerId);\n\n        // get the player paddle tied to the player socket\n        let playerPlate = this.world.queryObject({ playerId });\n        if (playerPlate) {\n            if (inputData.input === 'space') {\n\n                console.log(`player ${playerId} bit`);\n\n                playerPlate.bites++;\n            }\n        }\n    }\n\n    //\n    // SERVER ONLY CODE\n    //\n    serverSideInit() {\n        // create the paddles and the ball\n        this.addObjectToWorld(new Plate(this, null, { playerId: 0, bites: 0 }));\n        this.addObjectToWorld(new Plate(this, null, { playerId: 0, bites: 0 }));\n        this.addObjectToWorld(new Plate(this, null, { playerId: 0, bites: 0 }));\n        this.addObjectToWorld(new Plate(this, null, { playerId: 0, bites: 0 }));\n        this.addObjectToWorld(new Plate(this, null, { playerId: 0, bites: 0 }));\n        this.addObjectToWorld(new Plate(this, null, { playerId: 0, bites: 0 }));\n    }\n\n    // attach newly connected player to next available paddle\n    serverSidePlayerJoined(ev) {\nconsole.log('player joined' + ev.playerId);\n        const plates = this.world.queryObjects({ instanceType: Plate });\n\n        let joined = false;\n\n        plates.forEach(plate => {\n            if (joined) {\n                return;\n            }\n\n            if (plate.playerId === 0) {\nconsole.log('player matched to plage' + ev.playerId);\n                plate.playerId = ev.playerId;\n\n                joined = true;\n            }\n        })\n\nconsole.log('plates');\nconsole.log(plates);\n\n\n    }\n\n    serverSidePlayerDisconnected(ev) {\n        const plates = this.world.queryObjects({ instanceType: Plate });\n\n        plates.forEach(plate => {\n            if (plate.playerId !== ev.playerId) {\n                return;\n            }\n            console.log('plate removed');\n            this.removeObjectFromWorld(plate.id);\n        });\n    }\n\n    //\n    // CLIENT ONLY CODE\n    //\n    clientSideInit() {\n        this.controls = new KeyboardControls(this.renderer.clientEngine);\n        this.controls.bindKey('space', 'space');\n    }\n\n    clientSideDraw() {\n        let plates = this.world.queryObjects({ instanceType: Plate });\n\nconsole.log('plates.length');\nconsole.log(plates.length);\n\n        if (!plates.length) {\n            return;\n        }\n\n        plates.forEach((plate, i) => {\n            const selector = '#plate' + i;\n\nconsole.log('selector');\nconsole.log(selector);\n\n            const plateElement = document.querySelector(selector);\n\n            if (plateElement) {\n                plateElement.classList.remove('hidden');\n                plateElement.style.width = ((9 - plate.bites) * 20) + 'px';\n                plateElement.innerHTML = plate.playerId;\n            }\n        });\n    }\n}\n\n"],"file":"Game.js"}