{"version":3,"sources":["../../../src/common/lib/init-helpers.js"],"names":["initBites","game","controls","KeyboardControls","renderer","clientEngine","order","DEBUG","bites","document","querySelector","forEach","o","button","createElement","classList","add","setAttribute","innerHTML","addEventListener","ev","querySelectorAll","length","plate","world","queryObject","playerId","blocked","playing","sendInput","PLATE_BITES","i","children","appendChild","Math","random","b","remove","initNameForm","nameButton","target","value","disabled","emit","name","initPlayers","players","PLAYERS_COUNT","player","initStart","initTables","tables","table"],"mappings":"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","sourcesContent":["import { KeyboardControls } from 'lance-gg'\n\nimport { shuffle } from './misc.js'\n\nimport { DEBUG, PLATE_BITES, PLAYERS_COUNT } from './constants.js'\n\nconst initBites = game => {\n  game.controls = new KeyboardControls(game.renderer.clientEngine)\n\n  const order = [0, 1, 2, 3, 4, 5, 6, 7, 8]\n\n  if (!DEBUG) {\n    shuffle(order)\n  }\n\n  const bites = document.querySelector('#bites')\n\n  order.forEach(o => {\n    const button = document.createElement('button')\n\n    button.classList.add('bite', 'button')\n\n    button.setAttribute('data-order', o)\n\n    if (DEBUG) {\n      button.innerHTML = 'bite ' + o\n    }\n\n    button.addEventListener('click', ev => {\n      if (o !== document.querySelectorAll('.bite.hidden').length) {\n        return true\n      }\n\n      const plate = game.world.queryObject({ playerId: game.playerId })\n\n      if (!plate) {\n        return true\n      }\n\n      if (plate.blocked) {\n        return true\n      }\n\n      if (!plate.playing) {\n        return true\n      }\n\n      button.classList.add('hidden')\n\n      game.controls.clientEngine.sendInput('bite')\n\n      if (o === PLATE_BITES - 1) {\n        if (!DEBUG) {\n          const bites = document.querySelector('#bites')\n\n          for (let i = bites.children.length; i >= 0; i--) {\n            bites.appendChild(bites.children[Math.random() * i | 0])\n          }\n        }\n\n        document.querySelectorAll('.bite').forEach(b => b.classList.remove('hidden'))\n      }\n    })\n\n    bites.appendChild(button)\n  })\n}\n\nconst initNameForm = game => {\n  document.querySelector('#nameInput').addEventListener('keyup', ev => {\n    const nameButton = document.querySelector('#nameButton')\n\n    if (!ev.target.value.length) {\n      nameButton.classList.add('disabled')\n      nameButton.disabled = true\n\n      return true\n    }\n\n    nameButton.disabled = false\n  })\n\n  document.querySelector('#nameButton').addEventListener('click', ev => {\n    if (ev.target.disabled) {\n      return true\n    }\n\n    game.emit('nameee', {\n      name: document.querySelector('#nameInput').value,\n      playerId: game.playerId\n    })\n\n    ev.target.classList.add('hidden')\n    document.querySelector('#nameInput').classList.add('hidden')\n  })\n}\n\nconst initPlayers = () => {\n  const players = document.querySelector('#players')\n\n  for (let i = 0; i < PLAYERS_COUNT; i++) {\n    const player = document.createElement('div')\n\n    player.classList.add('player', 'hidden')\n\n    player.setAttribute('id', 'player' + i)\n\n    players.appendChild(player)\n  }\n}\n\nconst initStart = game => {\n  document.querySelector('#start').addEventListener('click', ev => {\n    game.controls.clientEngine.sendInput('start')\n\n    ev.target.classList.add('hidden')\n  })\n}\n\nconst initTables = () => {\n  const tables = document.querySelector('#tables')\n\n  for (let i = 0; i < PLAYERS_COUNT; i++) {\n    const table = document.createElement('div')\n\n    table.classList.add('table', 'button', 'hidden')\n\n    table.setAttribute('id', 'table' + i)\n\n    tables.appendChild(table)\n  }\n}\n\nexport { initBites, initNameForm, initPlayers, initStart, initTables }\n"],"file":"init-helpers.js"}